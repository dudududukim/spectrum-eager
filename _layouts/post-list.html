---
layout: default
---

{% comment %} Load section config and calculate variables once at the top {% endcomment %}
{% assign current_section = page.section | default: "tech-bites" %}
{% include get-section-config.html section_key=current_section %}
{% assign sorted_tech_bites = site.posts | where: "section", current_section | sort: 'date' | reverse %}
{% if site.section_definitions %}
    {% assign pagination_size = section_config.pagination | default: 10 %}
{% else %}
    {% assign pagination_size = 10 %}
{% endif %}

<div class="tech-bite-list-page">
    <div class="container">
        <header class="page-header">
            <h1 class="page-title">{{ page.title | default: "Posts" }}</h1>
            <p class="page-description">{{ page.description | default: "Browse all posts" }}</p>
        </header>

        <!-- Category Filter -->
        {% include category-filter.html section_config=section_config %}

        <!-- Tech Bites Grid -->
        <div class="tech-bites-grid">
            {% comment %} Check if sections are configured - if not, redirect to 404 {% endcomment %}
            {% unless site.section_definitions %}
                <script>
                    // Redirect to 404 page with reason - _sections folder or config files missing
                    const reason = encodeURIComponent("Configuration missing: Create _sections/<section-name>/config.yml files to configure sections. Example: Create _sections/tech-bites/config.yml with section settings.");
                    window.location.href = "{{ '/404.html' | relative_url }}?reason=" + reason;
                </script>
                <div class="empty-section-message">
                    <p>Redirecting to 404 page...</p>
                </div>
            {% else %}
                {% comment %} Sections are configured, check if content is available {% endcomment %}
                {% if sorted_tech_bites.size == 0 %}
                    {% comment %} Show info message instead of redirecting to 404 {% endcomment %}
                    <div class="empty-section-message">
                        <p>No posts yet for section "{{ current_section }}".</p>
                        <p>Add posts to <code>_posts/</code> folder with <code>section: "{{ current_section }}"</code> in front matter.</p>
                    </div>
                {% else %}
                    {% for tech_bite in sorted_tech_bites %}
                        {% include tech-bite-card.html tech_bite=tech_bite section_config=section_config %}
                    {% endfor %}
                {% endif %}
            {% endunless %}
        </div>

    </div>
</div>

<!-- Pagination (outside main-content, before footer) -->
{% if pagination_size and sorted_tech_bites.size > 0 %}
    {% assign total_pages = sorted_tech_bites.size | divided_by: pagination_size | plus: 1 %}
    {% if total_pages > 1 %}
        <nav class="pagination pagination-sticky" data-items-per-page="{{ pagination_size }}">
            <div class="pagination-numbers" id="pagination-numbers"></div>
        </nav>
    {% endif %}
{% endif %}

<script src="{{ '/assets/js/category-filter-pagination.js' | relative_url }}"></script>
